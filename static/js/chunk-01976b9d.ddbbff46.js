(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-01976b9d"],{3261:function(t,e,a){"use strict";var r=a("4469"),n=a.n(r);n.a},4469:function(t,e,a){},4600:function(t,e,a){"use strict";var r=a("b775"),n=a("4328"),o=a.n(n),i={MediaType:{application_form_urlencoded:{"Content-Type":"application/x-www-form-urlencoded"},application_json:{"Content-Type":"application/json"},multipart_form_data:{"Content-Type":"multipart/form-data"}},appId:"frostmourne",query:function(t){return t.params||(t.params={}),t.params._appId=t.params._appId||this.appId,t.params._t=(new Date).getTime(),Object(r["a"])(t)},get:function(t,e){return this.query({method:"get",url:t,params:e})},post:function(t,e){return this.query({method:"post",url:t,data:o.a.stringify(e),headers:this.MediaType.application_form_urlencoded})},json:function(t,e){return this.query({method:"post",url:t,data:e,headers:this.MediaType.application_json})}};e["a"]=i},"50fc":function(t,e,a){"use strict";var r=a("4600"),n="/api/monitor-api/admin",o={list:n+"/list",findById:n+"/findById",save:n+"/save",saveAnother:n+"/saveAnother",delete:n+"/delete",open:n+"/open",close:n+"/close"},i={getList:function(t,e,a,n,i,l){return r["a"].get(o.list,{account:"admin",alarmId:t,name:e,teamName:a,status:n,pageIndex:i,pageSize:l})},findById:function(t){return r["a"].get(o.findById,{account:"admin",alarmId:t})},save:function(t){return r["a"].json(o.save,t)},saveAnother:function(t){return r["a"].json(o.saveAnother,t)},operation:function(t,e){return r["a"].post(t,{alarmId:e})},delete:function(t){return this.operation(o.delete,t)},open:function(t){return this.operation(o.open,t)},close:function(t){return this.operation(o.close,t)},run:function(t){}};e["a"]=i},5493:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{size:"medium","label-position":"right",model:t.form,rules:t.rules,"label-width":"120px"}},[a("el-tabs",[a("el-tab-pane",{attrs:{label:"基础信息"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"监控名称:",prop:"alarm_name"}},[a("el-input",{model:{value:t.form.alarm_name,callback:function(e){t.$set(t.form,"alarm_name",e)},expression:"form.alarm_name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:""}},[a("el-switch",{attrs:{"active-value":"OPEN","active-text":"开启","inactive-value":"CLOSE","inactive-text":"关闭"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属对象:"}},[a("el-input",{attrs:{placeholder:"表示这个监控的归属对象关系"},model:{value:t.form.owner_key,callback:function(e){t.$set(t.form,"owner_key",e)},expression:"form.owner_key"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属团队:",prop:"team_name"}},[a("el-select",{attrs:{placeholder:"选择团队"},model:{value:t.form.team_name,callback:function(e){t.$set(t.form,"team_name",e)},expression:"form.team_name"}},t._l(t.teamList,(function(t){return a("el-option",{key:t.name,attrs:{label:t.fullName,value:t.name}})})),1)],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"描述:",prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1)],1)],1)],1),t._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"数据配置"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"数据:",prop:"metricContract.data_name"}},[a("el-cascader",{attrs:{width:"100",size:"medium","show-all-levels":!1,options:t.dataOptions},on:{change:t.dataChange},model:{value:t.dataValue,callback:function(e){t.dataValue=e},expression:"dataValue"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},["elasticsearch"===t.dataSourceType?a("el-form-item",{attrs:{label:"聚合类型:"}},[a("el-select",{model:{value:t.form.metricContract.aggregation_type,callback:function(e){t.$set(t.form.metricContract,"aggregation_type",e)},expression:"form.metricContract.aggregation_type"}},[a("el-option",{attrs:{label:"count",value:"count"}})],1)],1):t._e()],1),t._v(" "),a("el-col",{attrs:{span:8}},["avg"===t.form.metricContract.aggregation_type?a("el-form-item",{attrs:{label:"聚合字段:"}},[a("el-input",{model:{value:t.form.metricContract.aggregation_field,callback:function(e){t.$set(t.form.metricContract,"aggregation_field",e)},expression:"form.metricContract.aggregation_field"}})],1):t._e()],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"查询语句:",prop:"metricContract.query_string"}},[a("el-input",{model:{value:t.form.metricContract.query_string,callback:function(e){t.$set(t.form.metricContract,"query_string",e)},expression:"form.metricContract.query_string"}})],1),t._v(" "),"http"===t.dataSourceType?a("el-form-item",{attrs:{label:"POST数据:"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.metricContract.post_data,callback:function(e){t.$set(t.form.metricContract,"post_data",e)},expression:"form.metricContract.post_data"}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleHttpTest}},[t._v("测试请求")])],1):t._e()],1),t._v(" "),a("el-tab-pane",{attrs:{label:"报警规则"}},[a("el-form-item",{attrs:{label:"判断类型:",prop:"metricContract.metric_type"}},[a("el-select",{model:{value:t.form.metricContract.metric_type,callback:function(e){t.$set(t.form.metricContract,"metric_type",e)},expression:"form.metricContract.metric_type"}},["http"!=t.dataSourceType?a("el-option",{attrs:{label:"数值",value:"numeric"}}):t._e(),t._v(" "),"http"===t.dataSourceType?a("el-option",{attrs:{label:"Javascript表达式",value:"object"}}):t._e()],1)],1),t._v(" "),a("el-row",["numeric"==t.form.metricContract.metric_type?a("el-form-item",{attrs:{label:"判断规则:"}},[t._v("\n            最近\n            "),a("el-input-number",{attrs:{size:"small",min:1,label:"间隔分钟"},model:{value:t.form.ruleContract.settings.TIME_WINDOW,callback:function(e){t.$set(t.form.ruleContract.settings,"TIME_WINDOW",e)},expression:"form.ruleContract.settings.TIME_WINDOW"}}),t._v("分钟；指标数值\n            "),a("el-select",{staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"比较类型"},model:{value:t.form.ruleContract.settings.OPERATOR,callback:function(e){t.$set(t.form.ruleContract.settings,"OPERATOR",e)},expression:"form.ruleContract.settings.OPERATOR"}},[a("el-option",{attrs:{label:"<",value:"LESS"}}),t._v(" "),a("el-option",{attrs:{label:"<=",value:"LTE"}}),t._v(" "),a("el-option",{attrs:{label:"==",value:"EQUAL"}}),t._v(" "),a("el-option",{attrs:{label:">=",value:"GTE"}}),t._v(" "),a("el-option",{attrs:{label:">",value:"GREATER"}})],1),t._v(" "),a("el-input-number",{attrs:{size:"small",label:"阈值"},model:{value:t.form.ruleContract.settings.THRESHOLD,callback:function(e){t.$set(t.form.ruleContract.settings,"THRESHOLD",e)},expression:"form.ruleContract.settings.THRESHOLD"}})],1):t._e()],1),t._v(" "),"object"==t.form.metricContract.metric_type?a("el-form-item",{attrs:{label:"判断表达式:"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.ruleContract.settings.EXPRESSION,callback:function(e){t.$set(t.form.ruleContract.settings,"EXPRESSION",e)},expression:"form.ruleContract.settings.EXPRESSION"}})],1):t._e(),t._v(" "),"ring_than"==t.form.metricContract.metric_type?a("el-form-item",{attrs:{label:"判断规则:"}},[a("el-select",{model:{value:t.form.ruleContract.PERIOD_UNIT,callback:function(e){t.$set(t.form.ruleContract,"PERIOD_UNIT",e)},expression:"form.ruleContract.PERIOD_UNIT"}},[a("el-option",{attrs:{label:"周",value:"week"}}),t._v(" "),a("el-option",{attrs:{label:"日",value:"day"}}),t._v(" "),a("el-option",{attrs:{label:"小时",value:"hour"}}),t._v(" "),a("el-option",{attrs:{label:"分钟",value:"minute"}})],1),t._v("环比\n          "),a("el-select",{model:{value:t.form.ruleContract.settings.OPERATOR,callback:function(e){t.$set(t.form.ruleContract.settings,"OPERATOR",e)},expression:"form.ruleContract.settings.OPERATOR"}},[a("el-option",{attrs:{label:"增加",value:"increase"}}),t._v(" "),a("el-option",{attrs:{label:"减少",value:"decrease"}})],1),t._v("百分之\n          "),a("el-input",{staticStyle:{width:"200px"},model:{value:t.form.ruleContract.settings.PERCENT_THRESHOLD,callback:function(e){t.$set(t.form.ruleContract.settings,"PERCENT_THRESHOLD",e)},expression:"form.ruleContract.settings.PERCENT_THRESHOLD"}})],1):t._e()],1),t._v(" "),a("el-tab-pane",{attrs:{label:"消息模板"}},[a("el-form-item",{attrs:{label:"消息模板:",prop:"ruleContract.alert_template"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.form.ruleContract.alert_template,callback:function(e){t.$set(t.form.ruleContract,"alert_template",e)},expression:"form.ruleContract.alert_template"}})],1)],1)],1),t._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"报警发送"}},[a("el-form-item",{attrs:{label:"报警方式:",prop:"alertContract.ways"}},[a("el-checkbox-group",{attrs:{size:"small"},model:{value:t.form.alertContract.ways,callback:function(e){t.$set(t.form.alertContract,"ways",e)},expression:"form.alertContract.ways"}},[a("el-checkbox-button",{attrs:{label:"dingding"}},[t._v("钉钉")]),t._v(" "),a("el-checkbox-button",{attrs:{label:"email"}},[t._v("Email")]),t._v(" "),a("el-checkbox-button",{attrs:{label:"sms"}},[t._v("短信")])],1)],1),t._v(" "),t.form.alertContract.ways.includes("dingding")?a("el-form-item",{attrs:{label:"钉钉机器人:"}},[a("el-input",{attrs:{size:"small",placeholder:"选填"},model:{value:t.form.alertContract.ding_robot_hook,callback:function(e){t.$set(t.form.alertContract,"ding_robot_hook",e)},expression:"form.alertContract.ding_robot_hook"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"静默时间:"}},[a("el-input-number",{attrs:{size:"small",min:1,label:"静默时间"},model:{value:t.form.alertContract.silence,callback:function(e){t.$set(t.form.alertContract,"silence",e)},expression:"form.alertContract.silence"}}),t._v("分钟\n        ")],1),t._v(" "),a("el-form-item",{attrs:{label:"报警接收人:",prop:"alertContract.recipients"}},[t._l(t.form.alertContract.recipients,(function(e){return a("el-tag",{key:e,staticStyle:{"margin-right":"5px"},attrs:{closable:""},on:{close:function(a){return t.removeRecipient(e)}}},[t._v(t._s(e))])})),t._v(" "),t.recipient.visible?a("el-input",{ref:"addRecipient",staticClass:"input-new-tag",staticStyle:{width:"100px"},attrs:{size:"small"},on:{blur:t.inputRecipient},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.inputRecipient(e)}},model:{value:t.recipient.value,callback:function(e){t.$set(t.recipient,"value",e)},expression:"recipient.value"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showRecipient}},[t._v("+ 接收人")])],2)],1)],1),t._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"调度配置"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"每隔:"}},[a("el-select",{on:{change:t.intervalChangeHandler},model:{value:t.intervalCron,callback:function(e){t.intervalCron=e},expression:"intervalCron"}},[a("el-option",{attrs:{label:"1分钟",value:"0/1 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"2分钟",value:"0/2 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"3分钟",value:"0/3 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"5分钟",value:"0/5 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"10分钟",value:"0/10 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"15分钟",value:"0/15 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"30分钟",value:"0/30 * * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"1小时",value:"0 0/1 * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"2小时",value:"0 0/2 * * ?"}}),t._v(" "),a("el-option",{attrs:{label:"6小时",value:"0 0/6 * * ?"}})],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[t._v("或者")]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"每天:"}},[a("el-select",{on:{change:t.dayCronChangeHandler},model:{value:t.dayCron,callback:function(e){t.dayCron=e},expression:"dayCron"}},t._l(t.dayCronOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"cron表达式:",prop:"cron"}},[a("el-input",{model:{value:t.form.cron,callback:function(e){t.$set(t.form,"cron",e)},expression:"form.cron"}})],1)],1)],1),t._v(" "),a("el-form-item",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{type:"primary",disabled:t.disableSave},on:{click:t.onSubmit}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.onTest}},[t._v("测试")]),t._v(" "),t.enableSaveAnother?a("el-button",{attrs:{type:"primary"},on:{click:t.onSaveAnother}},[t._v("另存")]):t._e(),t._v(" "),a("el-button",{on:{click:t.onCancel}},[t._v("取消")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"响应数据",visible:t.httpResponseDialogVisible},on:{"update:visible":function(e){t.httpResponseDialogVisible=e}}},[a("div",[a("vue-json-pretty",{attrs:{data:t.httpResonseData}})],1)])],1)},n=[],o=a("9e04"),i=a("50fc"),l=a("c24f"),s=a("7e1e"),c=a("d538"),u=a.n(c),m={components:{VueJsonPretty:u.a},data:function(){return{intervalCron:"",dayCron:"",dayCronOptions:[],recipient:{value:"",visible:!1},disableSave:!1,activeName:"datasource_tab",id:this.$route.query.id,httpResonseData:{},httpResponseDialogVisible:!1,form:{alarm_name:"",owner_key:"",status:"OPEN",team_name:"",description:"",cron:"",metricContract:{query_string:"",post_data:null,aggregation_type:"",aggregation_field:"",metric_type:"",data_source_id:0,data_name_id:0,data_name:"",properties:{}},ruleContract:{rule_type:"",alert_template:"${Project}最近${TIME_WINDOW}分钟内有异常日志${NUMBER}条。最近一条异常信息:\r\n服务器IP: ${ServerIP}\r\n异常类型: ${ExceptionType}\r\n自定义信息: ${CustomMessage}\r\n异常信息: ${ExceptionMessage}",settings:{}},alertContract:{ways:[],recipients:[],silence:60}},rules:{alarm_name:[{required:!0,message:"请输入监控名称",trigger:"blur"}],team_name:[{required:!0,message:"请选择团队",trigger:"change"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}],"metricContract.data_name":[{required:!0,message:"请选择数据",trigger:"change"}],"metricContract.query_string":[{required:!0,message:"请输入查询语句",trigger:"blur"}],"metricContract.metric_type":[{required:!0,message:"请选择判断类型",trigger:"change"}],"ruleContract.alert_template":[{required:!0,message:"请输入消息模板",trigger:"blur"}],"alertContract.ways":[{type:"array",required:!0,message:"请至少选择一种报警方式",trigger:"change"}],"alertContract.recipients":[{type:"array",required:!0,message:"请配置报警接收人",trigger:"blur"}],cron:[{required:!0,message:"请输入cron表达式",trigger:"blur"}]},dataSourceType:"",dataValue:[],dataOptions:[],teamList:[],enableSaveAnother:!0}},mounted:function(){var t=this;this.initDayCronOptions(),this.id?(this.getDetail(),this.enableSaveAnother=!0):this.enableSaveAnother=!1,Object(l["d"])().then((function(e){t.teamList=e.result})),this.initDataOptions()},methods:{onSubmit:function(){var t=this;this.$refs["form"].validate((function(e){if(!e)return!1;t.disableSave=!1,i["a"].save(t.form).then((function(e){t.$message({type:"success",message:"保存成功！",duration:500,onClose:function(){return t.$router.push({path:"/alarm/list.view"})}})})).catch((function(e){t.$message({type:"success",message:"保存失败: "+e,duration:500})}))}))},onSaveAnother:function(){var t=this;i["a"].saveAnother(this.form).then((function(e){t.$message({type:"success",message:"另存成功！",duration:500,onClose:function(){return t.$router.push({path:"/alarm/list.view"})}})})).catch((function(t){console.log("另存失败:",t)}))},onTest:function(){var t=this;this.$refs["form"].validate((function(e){if(!e)return!1;o["a"].test(t.form).then((function(e){t.$alert('<pre style="overflow: auto">'+e.result+"</pre>","测试运行成功",{dangerouslyUseHTMLString:!0})})).catch((function(e){console.log("测试运行失败: "+e),t.$message({type:"success",message:"测试运行失败",duration:1500})}))}))},onCancel:function(){this.$router.push({path:"/alarm/list.view"})},getDetail:function(){var t=this;i["a"].findById(this.id).then((function(e){t.form=e.result,"http"===e.result.metricContract.data_name?(t.dataValue.push("http"),t.dataSourceType="http"):(t.dataValue.push(e.result.metricContract.dataSourceContract.datasource_type),t.dataValue.push(e.result.metricContract.dataSourceContract.id),t.dataValue.push(e.result.metricContract.data_name),t.dataSourceType=e.result.metricContract.dataSourceContract.datasource_type)}))},dataChange:function(t){return 0===t.length?(this.form.metricContract.data_source_id=0,void(this.form.metricContract.data_name="")):(this.dataSourceType=t[0],"http"===this.dataSourceType?(this.form.metricContract.data_source_id=0,this.form.metricContract.data_name="http",this.form.metricContract.metric_type="object",void(this.form.ruleContract.rule_type="expression")):(this.form.metricContract.data_source_id=t[1],this.form.metricContract.data_name=t[2],void(this.form.metricContract.metric_type="")))},tabClick:function(t,e){},removeRecipient:function(t){var e=this.form.alertContract.recipients.indexOf(t);this.form.alertContract.recipients.splice(e,1)},showRecipient:function(){var t=this;this.recipient.visible=!0,this.$nextTick((function(e){return t.$refs.addRecipient.$refs.input.focus()}))},inputRecipient:function(){var t=this.recipient.value;t&&this.form.alertContract.recipients.push(t),this.recipient.visible=!1,this.recipient.value=""},intervalChangeHandler:function(t){var e=(new Date).getSeconds();this.form.cron=e+" "+t},initDayCronOptions:function(){for(var t=0;t<24;t++)this.dayCronOptions.push({label:t+"点",value:"0 0 "+t+" * * ?"})},dayCronChangeHandler:function(t){this.form.cron=t},initDataOptions:function(){var t=this;s["a"].dataOptions().then((function(e){for(var a=e.result,r=0;r<a.length;r++){for(var n={label:a[r].datasourceType,value:a[r].datasourceType,children:[]},o=0;o<a[r].dataSourceOptionList.length;o++){for(var i={label:a[r].dataSourceOptionList[o].dataSource.datasource_name,value:a[r].dataSourceOptionList[o].dataSource.id,children:[]},l=0;l<a[r].dataSourceOptionList[o].dataNameContractList.length;l++)i.children.push({label:a[r].dataSourceOptionList[o].dataNameContractList[l].display_name,value:a[r].dataSourceOptionList[o].dataNameContractList[l].data_name});n.children.push(i)}t.dataOptions.push(n)}t.dataOptions.push({value:"http",label:"http"})}))},handleHttpTest:function(){var t=this;o["a"].httpTest(this.form.metricContract).then((function(e){t.httpResonseData=e.result,t.httpResponseDialogVisible=!0}))}}},p=m,d=(a("3261"),a("2877")),f=Object(d["a"])(p,r,n,!1,null,"4506b218",null);e["default"]=f.exports},"7e1e":function(t,e,a){"use strict";var r=a("4600"),n="/api/monitor-api/data",o={saveDataSource:function(t){return r["a"].json(n+"/saveDataSource",t)},removeDataSource:function(t){return r["a"].post(n+"/removeDataSource",{id:t})},findDataSource:function(t,e,a){return r["a"].get(n+"/findDataSource",{pageIndex:t,pageSize:e,datasourceType:a})},findDataSourceByType:function(t){return r["a"].get(n+"/findDataSourceByType",{datasourceType:t})},saveDataName:function(t){return r["a"].json(n+"/saveDataName",t)},removeDataName:function(t){return r["a"].post(n+"/removeDataName",{id:t})},findDataName:function(t,e,a,o){return r["a"].get(n+"/findDataName",{pageIndex:t,pageSize:e,datasourceType:a,datasourceId:o})},findDataNameByType:function(t){return r["a"].get(n+"/findDataNameByType",{datasourceType:t})},dataOptions:function(){return r["a"].get(n+"/dataOptions")}};e["a"]=o},"9e04":function(t,e,a){"use strict";var r=a("4600"),n="/api/monitor-api/alarm",o={run:n+"/run",test:n+"/test"},i={run:function(t){return r["a"].get(o.run,{alarmId:t})},test:function(t){return r["a"].json(o.test,t)},httpTest:function(t){return r["a"].json(n+"/httpTest",t)}};e["a"]=i}}]);